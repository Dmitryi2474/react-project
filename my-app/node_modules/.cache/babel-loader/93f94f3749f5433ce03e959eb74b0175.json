{"ast":null,"code":"/**\n * Module dependencies.\n */\n\nvar Polling = require('./polling');\nvar qs = require('querystring');\nvar rDoubleSlashes = /\\\\\\\\n/g;\nvar rSlashes = /(\\\\)?\\\\n/g;\nvar util = require('util');\n\n/**\n * Module exports.\n */\n\nmodule.exports = JSONP;\n\n/**\n * JSON-P polling transport.\n *\n * @api public\n */\n\nfunction JSONP(req) {\n  Polling.call(this, req);\n  this.head = '___eio[' + (req._query.j || '').replace(/[^0-9]/g, '') + '](';\n  this.foot = ');';\n}\n\n/**\n * Inherits from Polling.\n */\n\nutil.inherits(JSONP, Polling);\n\n/**\n * Handles incoming data.\n * Due to a bug in \\n handling by browsers, we expect a escaped string.\n *\n * @api private\n */\n\nJSONP.prototype.onData = function (data) {\n  // we leverage the qs module so that we get built-in DoS protection\n  // and the fast alternative to decodeURIComponent\n  data = qs.parse(data).d;\n  if ('string' === typeof data) {\n    // client will send already escaped newlines as \\\\\\\\n and newlines as \\\\n\n    // \\\\n must be replaced with \\n and \\\\\\\\n with \\\\n\n    data = data.replace(rSlashes, function (match, slashes) {\n      return slashes ? match : '\\n';\n    });\n    Polling.prototype.onData.call(this, data.replace(rDoubleSlashes, '\\\\n'));\n  }\n};\n\n/**\n * Performs the write.\n *\n * @api private\n */\n\nJSONP.prototype.doWrite = function (data, options, callback) {\n  // we must output valid javascript, not valid json\n  // see: http://timelessrepo.com/json-isnt-a-javascript-subset\n  var js = JSON.stringify(data).replace(/\\u2028/g, '\\\\u2028').replace(/\\u2029/g, '\\\\u2029');\n\n  // prepare response\n  data = this.head + js + this.foot;\n  Polling.prototype.doWrite.call(this, data, options, callback);\n};","map":{"version":3,"names":["Polling","require","qs","rDoubleSlashes","rSlashes","util","module","exports","JSONP","req","call","head","_query","j","replace","foot","inherits","prototype","onData","data","parse","d","match","slashes","doWrite","options","callback","js","JSON","stringify"],"sources":["/home/user/Рабочий стол/pizza/project/node_modules/engine.io/lib/transports/polling-jsonp.js"],"sourcesContent":["\n/**\n * Module dependencies.\n */\n\nvar Polling = require('./polling');\nvar qs = require('querystring');\nvar rDoubleSlashes = /\\\\\\\\n/g;\nvar rSlashes = /(\\\\)?\\\\n/g;\nvar util = require('util');\n\n/**\n * Module exports.\n */\n\nmodule.exports = JSONP;\n\n/**\n * JSON-P polling transport.\n *\n * @api public\n */\n\nfunction JSONP (req) {\n  Polling.call(this, req);\n\n  this.head = '___eio[' + (req._query.j || '').replace(/[^0-9]/g, '') + '](';\n  this.foot = ');';\n}\n\n/**\n * Inherits from Polling.\n */\n\nutil.inherits(JSONP, Polling);\n\n/**\n * Handles incoming data.\n * Due to a bug in \\n handling by browsers, we expect a escaped string.\n *\n * @api private\n */\n\nJSONP.prototype.onData = function (data) {\n  // we leverage the qs module so that we get built-in DoS protection\n  // and the fast alternative to decodeURIComponent\n  data = qs.parse(data).d;\n  if ('string' === typeof data) {\n    // client will send already escaped newlines as \\\\\\\\n and newlines as \\\\n\n    // \\\\n must be replaced with \\n and \\\\\\\\n with \\\\n\n    data = data.replace(rSlashes, function (match, slashes) {\n      return slashes ? match : '\\n';\n    });\n    Polling.prototype.onData.call(this, data.replace(rDoubleSlashes, '\\\\n'));\n  }\n};\n\n/**\n * Performs the write.\n *\n * @api private\n */\n\nJSONP.prototype.doWrite = function (data, options, callback) {\n  // we must output valid javascript, not valid json\n  // see: http://timelessrepo.com/json-isnt-a-javascript-subset\n  var js = JSON.stringify(data)\n    .replace(/\\u2028/g, '\\\\u2028')\n    .replace(/\\u2029/g, '\\\\u2029');\n\n  // prepare response\n  data = this.head + js + this.foot;\n\n  Polling.prototype.doWrite.call(this, data, options, callback);\n};\n"],"mappings":"AACA;AACA;AACA;;AAEA,IAAIA,OAAO,GAAGC,OAAO,CAAC,WAAW,CAAC;AAClC,IAAIC,EAAE,GAAGD,OAAO,CAAC,aAAa,CAAC;AAC/B,IAAIE,cAAc,GAAG,QAAQ;AAC7B,IAAIC,QAAQ,GAAG,WAAW;AAC1B,IAAIC,IAAI,GAAGJ,OAAO,CAAC,MAAM,CAAC;;AAE1B;AACA;AACA;;AAEAK,MAAM,CAACC,OAAO,GAAGC,KAAK;;AAEtB;AACA;AACA;AACA;AACA;;AAEA,SAASA,KAAK,CAAEC,GAAG,EAAE;EACnBT,OAAO,CAACU,IAAI,CAAC,IAAI,EAAED,GAAG,CAAC;EAEvB,IAAI,CAACE,IAAI,GAAG,SAAS,GAAG,CAACF,GAAG,CAACG,MAAM,CAACC,CAAC,IAAI,EAAE,EAAEC,OAAO,CAAC,SAAS,EAAE,EAAE,CAAC,GAAG,IAAI;EAC1E,IAAI,CAACC,IAAI,GAAG,IAAI;AAClB;;AAEA;AACA;AACA;;AAEAV,IAAI,CAACW,QAAQ,CAACR,KAAK,EAAER,OAAO,CAAC;;AAE7B;AACA;AACA;AACA;AACA;AACA;;AAEAQ,KAAK,CAACS,SAAS,CAACC,MAAM,GAAG,UAAUC,IAAI,EAAE;EACvC;EACA;EACAA,IAAI,GAAGjB,EAAE,CAACkB,KAAK,CAACD,IAAI,CAAC,CAACE,CAAC;EACvB,IAAI,QAAQ,KAAK,OAAOF,IAAI,EAAE;IAC5B;IACA;IACAA,IAAI,GAAGA,IAAI,CAACL,OAAO,CAACV,QAAQ,EAAE,UAAUkB,KAAK,EAAEC,OAAO,EAAE;MACtD,OAAOA,OAAO,GAAGD,KAAK,GAAG,IAAI;IAC/B,CAAC,CAAC;IACFtB,OAAO,CAACiB,SAAS,CAACC,MAAM,CAACR,IAAI,CAAC,IAAI,EAAES,IAAI,CAACL,OAAO,CAACX,cAAc,EAAE,KAAK,CAAC,CAAC;EAC1E;AACF,CAAC;;AAED;AACA;AACA;AACA;AACA;;AAEAK,KAAK,CAACS,SAAS,CAACO,OAAO,GAAG,UAAUL,IAAI,EAAEM,OAAO,EAAEC,QAAQ,EAAE;EAC3D;EACA;EACA,IAAIC,EAAE,GAAGC,IAAI,CAACC,SAAS,CAACV,IAAI,CAAC,CAC1BL,OAAO,CAAC,SAAS,EAAE,SAAS,CAAC,CAC7BA,OAAO,CAAC,SAAS,EAAE,SAAS,CAAC;;EAEhC;EACAK,IAAI,GAAG,IAAI,CAACR,IAAI,GAAGgB,EAAE,GAAG,IAAI,CAACZ,IAAI;EAEjCf,OAAO,CAACiB,SAAS,CAACO,OAAO,CAACd,IAAI,CAAC,IAAI,EAAES,IAAI,EAAEM,OAAO,EAAEC,QAAQ,CAAC;AAC/D,CAAC"},"metadata":{},"sourceType":"script"}