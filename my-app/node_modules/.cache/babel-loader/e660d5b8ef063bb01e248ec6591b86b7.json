{"ast":null,"code":"import _toConsumableArray from\"/home/user/\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B/react-project/my-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"/home/user/\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B/react-project/my-app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _regeneratorRuntime from\"/home/user/\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B/react-project/my-app/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/user/\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B/react-project/my-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import qs from'qs';import{useNavigate}from'react-router-dom';import React,{useEffect,useRef,useCallback}from'react';import{setCategotyId,setCurrentPage,setFliters,slectetFilter}from'../redux/slices/filterSlice';import{useDispatch,useSelector}from'react-redux';import{fetchMobile,slectetMobile}from'../redux/slices/mobileSlice';import Sort,{sortList}from'../components/Sort/Sort';import Categories from'../components/Categories/Categories';import Skeleton from'../components/MobileBlock/Skeleton/Skeleton';import MobileBlock from'../components/MobileBlock/MobileBlock';import Pagination from'../components/Pagination';import classes from'../scss/app.module.scss';import MapBlock from'../components/MapBlock/MapBlock';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Home=function Home(){var navigate=useNavigate();var dispatch=useDispatch();var isSearch=useRef(false);var isMounted=useRef(false);var _useSelector=useSelector(slectetFilter),categoryId=_useSelector.categoryId,sort=_useSelector.sort,currentPage=_useSelector.currentPage,searchValue=_useSelector.searchValue;var sortType=sort.sortProperty;var _useSelector2=useSelector(slectetMobile),items=_useSelector2.items,status=_useSelector2.status;var onChangeCategory=useCallback(function(idx){dispatch(setCategotyId(idx));// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);var onChangePage=function onChangePage(page){dispatch(setCurrentPage(page));};var getMobile=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var sortBy,order,category,search;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:sortBy=sortType.replace('-','');order=sortType.includes('-')?'возрастанию':'убыванию';category=categoryId>0?\"category=\".concat(categoryId):'';search=searchValue?\"&search=\".concat(searchValue):'';dispatch(//@ts-ignore\nfetchMobile({sortBy:sortBy,order:order,category:category,search:search,currentPage:currentPage}));case 5:case\"end\":return _context.stop();}}},_callee);}));return function getMobile(){return _ref.apply(this,arguments);};}();useEffect(function(){if(isMounted.current){var queryString=qs.stringify({sortProperty:sort.sortProperty,categoryId:categoryId,currentPage:currentPage});navigate(\"?\".concat(queryString));}isMounted.current=true;// eslint-disable-next-line react-hooks/exhaustive-deps\n},[categoryId,sort.sortProperty,currentPage]);useEffect(function(){if(window.location.search){var params=qs.parse(window.location.search.substring(1));var _sort=sortList.find(function(obj){return obj.sortProperty===params.sortProperty;});dispatch(setFliters(_objectSpread(_objectSpread({},params),{},{sort:_sort})));isSearch.current=true;}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);useEffect(function(){window.scrollTo(0,0);getMobile();isSearch.current=false;// eslint-disable-next-line react-hooks/exhaustive-deps\n},[categoryId,sort.sortProperty,searchValue,currentPage]);var skeleton=_toConsumableArray(new Array(4)).map(function(_,index){return/*#__PURE__*/_jsx(Skeleton,{},index);});var mobileBlock=items.map(function(obj){return/*#__PURE__*/_jsx(MobileBlock,_objectSpread({},obj),obj.id);});return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:classes.Top,children:[/*#__PURE__*/_jsx(Categories,{value:categoryId,onChangeCategory:onChangeCategory}),/*#__PURE__*/_jsx(Sort,{})]}),/*#__PURE__*/_jsx(\"h2\",{className:classes.Title,children:\"\\u0412\\u0441\\u0435 \\u0441\\u043C\\u0430\\u0440\\u0442\\u0444\\u043E\\u043D\\u044B\"}),status==='error'?/*#__PURE__*/_jsxs(\"div\",{className:classes.Error,children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u0447\\u0442\\u043E-\\u0442\\u043E \\u043F\\u043E\\u0448\\u043B\\u043E \\u043D\\u0435 \\u0442\\u0430\\u043A((\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u043F\\u043E\\u043F\\u0440\\u043E\\u0431\\u0443\\u0439\\u0442\\u0435 \\u043F\\u043E\\u0432\\u0442\\u043E\\u0440\\u0438\\u0442\\u044C \\u043F\\u043E\\u043F\\u044B\\u0442\\u043A\\u0443 \\u043F\\u043E\\u0437\\u0436\\u0435\"})]}):/*#__PURE__*/_jsx(\"div\",{className:classes.Items,children:status==='loading'?skeleton:mobileBlock}),/*#__PURE__*/_jsx(Pagination,{currentPage:currentPage,onChangePage:onChangePage}),/*#__PURE__*/_jsx(MapBlock,{})]});};export default Home;","map":{"version":3,"names":["qs","useNavigate","React","useEffect","useRef","useCallback","setCategotyId","setCurrentPage","setFliters","slectetFilter","useDispatch","useSelector","fetchMobile","slectetMobile","Sort","sortList","Categories","Skeleton","MobileBlock","Pagination","classes","MapBlock","Home","navigate","dispatch","isSearch","isMounted","categoryId","sort","currentPage","searchValue","sortType","sortProperty","items","status","onChangeCategory","idx","onChangePage","page","getMobile","sortBy","replace","order","includes","category","search","current","queryString","stringify","window","location","params","parse","substring","find","obj","scrollTo","skeleton","Array","map","_","index","mobileBlock","id","Top","Title","Error","Items"],"sources":["/home/user/Рабочий стол/react-project/my-app/src/Pages/Home.tsx"],"sourcesContent":["import qs from 'qs';\nimport { useNavigate } from 'react-router-dom';\nimport React, { useEffect, useRef, useCallback } from 'react';\n\nimport {\n  setCategotyId,\n  setCurrentPage,\n  setFliters,\n  slectetFilter,\n} from '../redux/slices/filterSlice';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { fetchMobile, slectetMobile } from '../redux/slices/mobileSlice';\n\nimport Sort, { sortList } from '../components/Sort/Sort';\nimport Categories from '../components/Categories/Categories';\nimport Skeleton from '../components/MobileBlock/Skeleton/Skeleton';\nimport MobileBlock from '../components/MobileBlock/MobileBlock';\nimport Pagination from '../components/Pagination';\n\nimport classes from '../scss/app.module.scss';\nimport MapBlock from '../components/MapBlock/MapBlock';\n\nconst Home: React.FC = () => {\n  const navigate = useNavigate();\n  const dispatch = useDispatch();\n  const isSearch = useRef(false);\n  const isMounted = useRef(false);\n\n  const { categoryId, sort, currentPage, searchValue } =\n    useSelector(slectetFilter);\n  const sortType = sort.sortProperty;\n\n  const { items, status } = useSelector(slectetMobile);\n\n  const onChangeCategory = useCallback((idx: number) => {\n    dispatch(setCategotyId(idx));\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const onChangePage = (page: number) => {\n    dispatch(setCurrentPage(page));\n  };\n\n  const getMobile = async () => {\n    const sortBy = sortType.replace('-', '');\n    const order = sortType.includes('-') ? 'возрастанию' : 'убыванию';\n    const category = categoryId > 0 ? `category=${categoryId}` : '';\n    const search = searchValue ? `&search=${searchValue}` : '';\n\n    dispatch(\n      //@ts-ignore\n      fetchMobile({\n        sortBy,\n        order,\n        category,\n        search,\n        currentPage,\n      })\n    );\n  };\n\n  useEffect(() => {\n    if (isMounted.current) {\n      const queryString = qs.stringify({\n        sortProperty: sort.sortProperty,\n        categoryId,\n        currentPage,\n      });\n\n      navigate(`?${queryString}`);\n    }\n    isMounted.current = true;\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [categoryId, sort.sortProperty, currentPage]);\n\n  useEffect(() => {\n    if (window.location.search) {\n      const params = qs.parse(window.location.search.substring(1));\n\n      const sort = sortList.find(\n        (obj) => obj.sortProperty === params.sortProperty\n      );\n\n      dispatch(\n        setFliters({\n          ...params,\n          sort,\n        })\n      );\n      isSearch.current = true;\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  useEffect(() => {\n    window.scrollTo(0, 0);\n    getMobile();\n    isSearch.current = false;\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [categoryId, sort.sortProperty, searchValue, currentPage]);\n\n  const skeleton = [...new Array(4)].map((_, index) => (\n    <Skeleton key={index} />\n  ));\n  const mobileBlock = items.map((obj: any) => <MobileBlock key={obj.id} {...obj} />);\n\n  return (\n    <div>\n      <div className={classes.Top}>\n        <Categories value={categoryId} onChangeCategory={onChangeCategory} />\n        <Sort />\n      </div>\n      <h2 className={classes.Title}>Все смартфоны</h2>\n      {status === 'error' ? (\n        <div className={classes.Error}>\n          <h2>что-то пошло не так((</h2>\n          <span>попробуйте повторить попытку позже</span>\n        </div>\n      ) : (\n        <div className={classes.Items}>\n          {status === 'loading' ? skeleton : mobileBlock}\n        </div>\n      )}\n      <Pagination currentPage={currentPage} onChangePage={onChangePage} />\n      <MapBlock/>\n    </div>\n  );\n};\n\nexport default Home;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}