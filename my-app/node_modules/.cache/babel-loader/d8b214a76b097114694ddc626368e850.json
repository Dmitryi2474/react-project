{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar path = require(\"path\");\nvar fs_1 = require(\"fs\");\nvar immutable_1 = require(\"immutable\");\nvar utils = require(\"../utils\");\nvar cli_options_1 = require(\"./cli-options\");\nvar _ = require(\"../lodash.custom\");\n/**\n * $ browser-sync start <options>\n *\n * This commands starts the Browsersync servers\n * & Optionally UI.\n *\n * @param opts\n * @returns {Function}\n */\nfunction default_1(opts) {\n  var flags = preprocessFlags(opts.cli.flags);\n  var cwd = flags.cwd || process.cwd();\n  var maybepkg = path.resolve(cwd, \"package.json\");\n  var input = flags;\n  if (flags.config) {\n    var maybeconf = path.resolve(cwd, flags.config);\n    if (fs_1.existsSync(maybeconf)) {\n      var conf = require(maybeconf);\n      input = _.merge({}, conf, flags);\n    } else {\n      utils.fail(true, new Error(\"Configuration file '\" + flags.config + \"' not found\"), opts.cb);\n    }\n  } else {\n    if (fs_1.existsSync(maybepkg)) {\n      var pkg = require(maybepkg);\n      if (pkg[\"browser-sync\"]) {\n        console.log(\"> Configuration obtained from package.json\");\n        input = _.merge({}, pkg[\"browser-sync\"], flags);\n      }\n    }\n  }\n  return require(\"../\").create(\"cli\").init(input, opts.cb);\n}\nexports.default = default_1;\n/**\n * @param flags\n * @returns {*}\n */\nfunction preprocessFlags(flags) {\n  return [stripUndefined, legacyFilesArgs, removeWatchBooleanWhenFalse].reduce(function (flags, fn) {\n    return fn.call(null, flags);\n  }, flags);\n}\n/**\n * Incoming undefined values are problematic as\n * they interfere with Immutable.Map.mergeDeep\n * @param subject\n * @returns {*}\n */\nfunction stripUndefined(subject) {\n  return Object.keys(subject).reduce(function (acc, key) {\n    var value = subject[key];\n    if (typeof value === \"undefined\") {\n      return acc;\n    }\n    acc[key] = value;\n    return acc;\n  }, {});\n}\n/**\n * @param flags\n * @returns {*}\n */\nfunction legacyFilesArgs(flags) {\n  if (flags.files && flags.files.length) {\n    flags.files = flags.files.reduce(function (acc, item) {\n      return acc.concat(cli_options_1.explodeFilesArg(item));\n    }, []);\n  }\n  return flags;\n}\n/**\n * `watch` is a CLI boolean so should be removed if false to\n * allow config to set watch: true\n * @param flags\n * @returns {any}\n */\nfunction removeWatchBooleanWhenFalse(flags) {\n  if (flags.watch === false) {\n    return immutable_1.fromJS(flags).delete(\"watch\").toJS();\n  }\n  return flags;\n}","map":{"version":3,"mappings":"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","names":["_","require","opts","flags","preprocessFlags","cli","cwd","process","maybepkg","path","resolve","input","config","maybeconf","fs_1","conf","merge","utils","fail","Error","cb","pkg","console","log","create","init","exports","stripUndefined","legacyFilesArgs","removeWatchBooleanWhenFalse","reduce","fn","call","subject","Object","keys","acc","key","value","files","length","item","concat","cli_options_1","watch","immutable_1","delete","toJS"],"sources":["../../lib/cli/command.start.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}