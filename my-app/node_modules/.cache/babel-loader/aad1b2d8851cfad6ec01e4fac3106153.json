{"ast":null,"code":"\"use strict\";\n\nvar messages = require(\"./connect-utils\");\nvar utils = require(\"./utils\");\nvar _ = require(\"./lodash.custom\");\nvar template = \"[{blue:%s}] \";\nvar logger = require(\"eazy-logger\").Logger({\n  useLevelPrefixes: false\n});\nmodule.exports.logger = logger;\n/**\n * @param name\n * @returns {*}\n */\nmodule.exports.getLogger = function (name) {\n  return logger.clone(function (config) {\n    config.prefix = config.prefix + template.replace(\"%s\", name);\n    return config;\n  });\n};\n/**\n * Logging Callbacks\n */\nmodule.exports.callbacks = {\n  /**\n   * Log when file-watching has started\n   * @param {BrowserSync} bs\n   * @param data\n   */\n  \"file:watching\": function (bs, data) {\n    if (Object.keys(data).length) {\n      logger.info(\"Watching files...\");\n    }\n  },\n  /**\n   * Log when a file changes\n   * @param {BrowserSync} bs\n   * @param data\n   */\n  \"file:reload\": function (bs, data) {\n    if (canLogFileChange(bs, data)) {\n      if (data.path[0] === \"*\") {\n        return logger.info(\"{cyan:Reloading files that match: {magenta:%s\", data.path);\n      }\n      logger.info(\"{cyan:File event [\" + data.event + \"] : {magenta:%s\", data.path);\n    }\n  },\n  /**\n   *\n   */\n  \"service:exit\": function () {\n    logger.debug(\"Exiting...\");\n  },\n  /**\n   *\n   */\n  \"browser:reload\": function (bs, data) {\n    if (data === void 0) {\n      data = {};\n    }\n    if (canLogFileChange(bs)) {\n      if (data.files && data.files.length > 1) {\n        return logger.info(\"{cyan:Reloading Browsers... (buffered \" + data.files.length + \" events)\");\n      }\n      logger.info(\"{cyan:Reloading Browsers...\");\n    }\n  },\n  /**\n   *\n   */\n  \"browser:error\": function () {\n    logger.error(\"Couldn't open browser (if you are using BrowserSync in a headless environment, you might want to set the {cyan:open} option to {cyan:false})\");\n  },\n  /**\n   * @param {BrowserSync} bs\n   * @param data\n   */\n  \"stream:changed\": function (bs, data) {\n    if (canLogFileChange(bs)) {\n      var changed = data.changed;\n      logger.info(\"{cyan:%s %s changed} ({magenta:%s})\", changed.length, changed.length > 1 ? \"files\" : \"file\", changed.join(\", \"));\n    }\n  },\n  /**\n   * Client connected logging\n   * @param {BrowserSync} bs\n   * @param data\n   */\n  \"client:connected\": function (bs, data) {\n    var uaString = utils.getUaString(data.ua);\n    var msg = \"{cyan:Browser Connected: {magenta:%s, version: %s}\";\n    var method = \"info\";\n    if (!bs.options.get(\"logConnections\")) {\n      method = \"debug\";\n    }\n    logger.log(method, msg, uaString.name, uaString.version);\n  },\n  /**\n   * Main logging when the service is running\n   * @param {BrowserSync} bs\n   * @param data\n   */\n  \"service:running\": function (bs, data) {\n    var type = data.type;\n    if (bs.options.get('json')) {\n      return console.log(JSON.stringify({\n        \"service:running\": {\n          \"options\": bs.options.toJS()\n        }\n      }));\n    }\n    if (type === \"server\") {\n      var baseDir = bs.options.getIn([\"server\", \"baseDir\"]);\n      logUrls(bs.options.get(\"urls\").toJS());\n      if (baseDir) {\n        if (utils.isList(baseDir)) {\n          baseDir.forEach(serveFiles);\n        } else {\n          serveFiles(baseDir);\n        }\n      }\n    }\n    if (type === \"proxy\") {\n      logger.info(\"Proxying: {cyan:%s}\", bs.options.getIn([\"proxy\", \"target\"]));\n      logUrls(bs.options.get(\"urls\").toJS());\n    }\n    if (type === \"snippet\") {\n      if (bs.options.get(\"logSnippet\")) {\n        logger.info(\"{bold:Copy the following snippet into your website, \" + \"just before the closing {cyan:</body>} tag\");\n        logger.unprefixed(\"info\", messages.scriptTags(bs.options));\n      }\n      logUrls(bs.options.get(\"urls\").filter(function (value, key) {\n        return key.slice(0, 2) === \"ui\";\n      }).toJS());\n    }\n    function serveFiles(base) {\n      logger.info(\"Serving files from: {magenta:%s}\", base);\n    }\n  }\n};\n/**\n * Plugin interface for BrowserSync\n * @param {EventEmitter} emitter\n * @param {BrowserSync} bs\n * @returns {Object}\n */\nmodule.exports.plugin = function (emitter, bs) {\n  var logPrefix = bs.options.get(\"logPrefix\");\n  var logLevel = bs.options.get(\"logLevel\");\n  // Should set logger level here!\n  logger.setLevel(logLevel);\n  if (logPrefix) {\n    if (_.isFunction(logPrefix)) {\n      logger.setPrefix(logPrefix);\n    } else {\n      logger.setPrefix(template.replace(\"%s\", logPrefix));\n    }\n  }\n  _.each(exports.callbacks, function (func, event) {\n    emitter.on(event, func.bind(this, bs));\n  });\n  return logger;\n};\n/**\n *\n * @param urls\n */\nfunction logUrls(urls) {\n  var keys = Object.keys(urls);\n  var longestName = 0;\n  var longesturl = 0;\n  var offset = 2;\n  if (!keys.length) {\n    return;\n  }\n  var names = keys.map(function (key) {\n    if (key.length > longestName) {\n      longestName = key.length;\n    }\n    if (urls[key].length > longesturl) {\n      longesturl = urls[key].length;\n    }\n    return key;\n  });\n  var underline = getChars(longestName + offset + longesturl + 1, \"-\");\n  var underlined = false;\n  logger.info(\"{bold:Access URLs:\");\n  logger.unprefixed(\"info\", \"{grey: %s\", underline);\n  keys.forEach(function (key, i) {\n    var keyname = getKeyName(key);\n    logger.unprefixed(\"info\", \" %s: {magenta:%s}\", getPadding(key.length, longestName + offset) + keyname, urls[key]);\n    if (!underlined && names[i + 1] && names[i + 1].indexOf(\"ui\") > -1) {\n      underlined = true;\n      logger.unprefixed(\"info\", \"{grey: %s}\", underline);\n    }\n  });\n  logger.unprefixed(\"info\", \"{grey: %s}\", underline);\n}\n/**\n * @param {Number} len\n * @param {Number} max\n * @returns {string}\n */\nfunction getPadding(len, max) {\n  return new Array(max - (len + 1)).join(\" \");\n}\n/**\n * @param {Number} len\n * @param {String} char\n * @returns {string}\n */\nfunction getChars(len, char) {\n  return new Array(len).join(char);\n}\n/**\n * Transform url-key names into something more presentable\n * @param key\n * @returns {string}\n */\nfunction getKeyName(key) {\n  if (key.indexOf(\"ui\") > -1) {\n    if (key === \"ui\") {\n      return \"UI\";\n    }\n    if (key === \"ui-external\") {\n      return \"UI External\";\n    }\n  }\n  return key.substr(0, 1).toUpperCase() + key.substring(1);\n}\n/**\n * Determine if file changes should be logged\n * @param bs\n * @param data\n * @returns {boolean}\n */\nfunction canLogFileChange(bs, data) {\n  if (data && data.log === false) {\n    return false;\n  }\n  return bs.options.get(\"logFileChanges\");\n}","map":{"version":3,"mappings":"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","names":["messages","require","utils","_","template","logger","Logger","useLevelPrefixes","module","exports","getLogger","name","clone","config","prefix","replace","callbacks","bs","data","Object","keys","length","info","canLogFileChange","path","event","debug","files","error","changed","join","uaString","getUaString","ua","msg","method","options","get","log","version","type","console","JSON","stringify","toJS","baseDir","getIn","logUrls","isList","forEach","serveFiles","unprefixed","scriptTags","filter","value","key","slice","base","plugin","emitter","logPrefix","logLevel","setLevel","isFunction","setPrefix","each","func","on","bind","urls","longestName","longesturl","offset","names","map","underline","getChars","underlined","i","keyname","getKeyName","getPadding","indexOf","len","max","Array","char","substr","toUpperCase","substring"],"sources":["../lib/logger.js"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}