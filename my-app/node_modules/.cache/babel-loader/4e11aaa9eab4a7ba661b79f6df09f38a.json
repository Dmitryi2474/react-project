{"ast":null,"code":"\"use strict\";\n\nvar hooks = require(\"./hooks\");\nvar asyncTasks = require(\"./async-tasks\");\nvar config = require(\"./config\");\nvar connectUtils = require(\"./connect-utils\");\nvar utils = require(\"./utils\");\nvar logger = require(\"./logger\");\nvar eachSeries = utils.eachSeries;\nvar _ = require(\"./lodash.custom\");\nvar EE = require(\"easy-extender\");\n/**\n * Required internal plugins.\n * Any of these can be overridden by deliberately\n * causing a name-clash.\n */\nvar defaultPlugins = {\n  logger: logger,\n  socket: require(\"./sockets\"),\n  \"file:watcher\": require(\"./file-watcher\"),\n  server: require(\"./server\"),\n  tunnel: require(\"./tunnel\"),\n  \"client:script\": require(\"browser-sync-client\"),\n  UI: require(\"browser-sync-ui\")\n};\n/**\n * @constructor\n */\nvar BrowserSync = function (emitter) {\n  var bs = this;\n  bs.cwd = process.cwd();\n  bs.active = false;\n  bs.paused = false;\n  bs.config = config;\n  bs.utils = utils;\n  bs.events = bs.emitter = emitter;\n  bs._userPlugins = [];\n  bs._reloadQueue = [];\n  bs._cleanupTasks = [];\n  bs._browserReload = false;\n  // Plugin management\n  bs.pluginManager = new EE(defaultPlugins, hooks);\n};\n/**\n * Call a user-options provided callback\n * @param name\n */\nBrowserSync.prototype.callback = function (name) {\n  var bs = this;\n  var cb = bs.options.getIn([\"callbacks\", name]);\n  if (_.isFunction(cb)) {\n    cb.apply(bs.publicInstance, _.toArray(arguments).slice(1));\n  }\n};\n/**\n * @param {Map} options\n * @param {Function} cb\n * @returns {BrowserSync}\n */\nBrowserSync.prototype.init = function (options, cb) {\n  /**\n   * Safer access to `this`\n   * @type {BrowserSync}\n   */\n  var bs = this;\n  /**\n   * Set user-provided callback, or assign a noop\n   * @type {Function}\n   */\n  bs.cb = cb || utils.defaultCallback;\n  /**\n   * Verify provided config.\n   * Some options are not compatible and will cause us to\n   * end the process.\n   */\n  if (!utils.verifyConfig(options, bs.cb)) {\n    return;\n  }\n  /**\n   * Save a reference to the original options\n   * @type {Map}\n   * @private\n   */\n  bs._options = options;\n  /**\n   * Set additional options that depend on what the\n   * user may of provided\n   * @type {Map}\n   */\n  bs.options = options;\n  /**\n   * Kick off default plugins.\n   */\n  bs.pluginManager.init();\n  /**\n   * Create a base logger & debugger.\n   */\n  bs.logger = bs.pluginManager.get(\"logger\")(bs.events, bs);\n  bs.debugger = bs.logger.clone({\n    useLevelPrefixes: true\n  });\n  bs.debug = bs.debugger.debug;\n  /**\n   * Run each setup task in sequence\n   */\n  eachSeries(asyncTasks, taskRunner(bs), tasksComplete(bs));\n  return this;\n};\n/**\n * Run 1 setup task.\n * Each task is a pure function.\n * They can return options or instance properties to set,\n * but they cannot set them directly.\n * @param {BrowserSync} bs\n * @returns {Function}\n */\nfunction taskRunner(bs) {\n  return function (item, cb) {\n    bs.debug(\"-> {yellow:Starting Step: \" + item.step);\n    /**\n     * Execute the current task.\n     */\n    item.fn(bs, executeTask);\n    function executeTask(err, out) {\n      /**\n       * Exit early if any task returned an error.\n       */\n      if (err) {\n        return cb(err);\n      }\n      /**\n       * Act on return values (such as options to be set,\n       * or instance properties to be set\n       */\n      if (out) {\n        handleOut(bs, out);\n      }\n      bs.debug(\"+  {green:Step Complete: \" + item.step);\n      cb();\n    }\n  };\n}\n/**\n * @param bs\n * @param out\n */\nfunction handleOut(bs, out) {\n  /**\n   * Set a single/many option.\n   */\n  if (out.options) {\n    setOptions(bs, out.options);\n  }\n  /**\n   * Any options returned that require path access?\n   */\n  if (out.optionsIn) {\n    out.optionsIn.forEach(function (item) {\n      bs.setOptionIn(item.path, item.value);\n    });\n  }\n  /**\n   * Any instance properties returned?\n   */\n  if (out.instance) {\n    Object.keys(out.instance).forEach(function (key) {\n      bs[key] = out.instance[key];\n    });\n  }\n}\n/**\n * Update the options Map\n * @param bs\n * @param options\n */\nfunction setOptions(bs, options) {\n  /**\n   * If multiple options were set, act on the immutable map\n   * in an efficient way\n   */\n  if (Object.keys(options).length > 1) {\n    bs.setMany(function (item) {\n      Object.keys(options).forEach(function (key) {\n        item.set(key, options[key]);\n        return item;\n      });\n    });\n  } else {\n    Object.keys(options).forEach(function (key) {\n      bs.setOption(key, options[key]);\n    });\n  }\n}\n/**\n * At this point, ALL async tasks have completed\n * @param {BrowserSync} bs\n * @returns {Function}\n */\nfunction tasksComplete(bs) {\n  return function (err) {\n    if (err) {\n      bs.logger.setOnce(\"useLevelPrefixes\", true).error(err.message);\n    }\n    /**\n     * Set active flag\n     */\n    bs.active = true;\n    /**\n     * @deprecated\n     */\n    bs.events.emit(\"init\", bs);\n    /**\n     * This is no-longer needed as the Callback now only resolves\n     * when everything (including slow things, like the tunnel) is ready.\n     * It's here purely for backwards compatibility.\n     * @deprecated\n     */\n    bs.events.emit(\"service:running\", {\n      options: bs.options,\n      baseDir: bs.options.getIn([\"server\", \"baseDir\"]),\n      type: bs.options.get(\"mode\"),\n      port: bs.options.get(\"port\"),\n      url: bs.options.getIn([\"urls\", \"local\"]),\n      urls: bs.options.get(\"urls\").toJS(),\n      tunnel: bs.options.getIn([\"urls\", \"tunnel\"])\n    });\n    /**\n     * Call any option-provided callbacks\n     */\n    bs.callback(\"ready\", null, bs);\n    /**\n     * Finally, call the user-provided callback given as last arg\n     */\n    bs.cb(null, bs);\n  };\n}\n/**\n * @param module\n * @param opts\n * @param cb\n */\nBrowserSync.prototype.registerPlugin = function (module, opts, cb) {\n  var bs = this;\n  bs.pluginManager.registerPlugin(module, opts, cb);\n  if (module[\"plugin:name\"]) {\n    bs._userPlugins.push(module);\n  }\n};\n/**\n * Get a plugin by name\n * @param name\n */\nBrowserSync.prototype.getUserPlugin = function (name) {\n  var bs = this;\n  var items = bs.getUserPlugins(function (item) {\n    return item[\"plugin:name\"] === name;\n  });\n  if (items && items.length) {\n    return items[0];\n  }\n  return false;\n};\n/**\n * @param {Function} [filter]\n */\nBrowserSync.prototype.getUserPlugins = function (filter) {\n  var bs = this;\n  filter = filter || function () {\n    return true;\n  };\n  /**\n   * Transform Plugins option\n   */\n  bs.userPlugins = bs._userPlugins.filter(filter).map(function (plugin) {\n    return {\n      name: plugin[\"plugin:name\"],\n      active: plugin._enabled,\n      opts: bs.pluginManager.pluginOptions[plugin[\"plugin:name\"]]\n    };\n  });\n  return bs.userPlugins;\n};\n/**\n * Get middleware\n * @returns {*}\n */\nBrowserSync.prototype.getMiddleware = function (type) {\n  var types = {\n    connector: connectUtils.socketConnector(this.options)\n  };\n  if (type in types) {\n    return function (req, res) {\n      res.setHeader(\"Content-Type\", \"text/javascript\");\n      res.end(types[type]);\n    };\n  }\n};\n/**\n * Shortcut for pushing a file-serving middleware\n * onto the stack\n * @param {String} path\n * @param {{type: string, content: string}} props\n */\nvar _serveFileCount = 0;\nBrowserSync.prototype.serveFile = function (path, props) {\n  var bs = this;\n  var mode = bs.options.get(\"mode\");\n  var entry = {\n    handle: function (req, res) {\n      res.setHeader(\"Content-Type\", props.type);\n      res.end(props.content);\n    },\n    id: \"Browsersync - \" + _serveFileCount++,\n    route: path\n  };\n  bs._addMiddlewareToStack(entry);\n};\n/**\n * Add middlewares on the fly\n */\nBrowserSync.prototype._addMiddlewareToStack = function (entry) {\n  var bs = this;\n  /**\n   * additional middlewares are always appended -1,\n   * this is to allow the proxy middlewares to remain,\n   * and the directory index to remain in serveStatic/snippet modes\n   */\n  bs.app.stack.splice(bs.app.stack.length - 1, 0, entry);\n};\nvar _addMiddlewareCount = 0;\nBrowserSync.prototype.addMiddleware = function (route, handle, opts) {\n  var bs = this;\n  if (!bs.app) {\n    return;\n  }\n  opts = opts || {};\n  if (!opts.id) {\n    opts.id = \"bs-mw-\" + _addMiddlewareCount++;\n  }\n  if (route === \"*\") {\n    route = \"\";\n  }\n  var entry = {\n    id: opts.id,\n    route: route,\n    handle: handle\n  };\n  if (opts.override) {\n    entry.override = true;\n  }\n  bs.options = bs.options.update(\"middleware\", function (mw) {\n    if (bs.options.get(\"mode\") === \"proxy\") {\n      return mw.insert(mw.size - 1, entry);\n    }\n    return mw.concat(entry);\n  });\n  bs.resetMiddlewareStack();\n};\n/**\n * Remove middlewares on the fly\n * @param {String} id\n * @returns {Server}\n */\nBrowserSync.prototype.removeMiddleware = function (id) {\n  var bs = this;\n  if (!bs.app) {\n    return;\n  }\n  bs.options = bs.options.update(\"middleware\", function (mw) {\n    return mw.filter(function (mw) {\n      return mw.id !== id;\n    });\n  });\n  bs.resetMiddlewareStack();\n};\n/**\n * Middleware for socket connection (external usage)\n * @param opts\n * @returns {*}\n */\nBrowserSync.prototype.getSocketConnector = function (opts) {\n  var bs = this;\n  return function (req, res) {\n    res.setHeader(\"Content-Type\", \"text/javascript\");\n    res.end(bs.getExternalSocketConnector(opts));\n  };\n};\n/**\n * Socket connector as a string\n * @param {Object} opts\n * @returns {*}\n */\nBrowserSync.prototype.getExternalSocketConnector = function (opts) {\n  var bs = this;\n  return connectUtils.socketConnector(bs.options.withMutations(function (item) {\n    item.set(\"socket\", item.get(\"socket\").merge(opts));\n    if (!bs.options.getIn([\"proxy\", \"ws\"])) {\n      item.set(\"mode\", \"snippet\");\n    }\n  }));\n};\n/**\n * Callback helper\n * @param name\n */\nBrowserSync.prototype.getOption = function (name) {\n  this.debug(\"Getting option: {magenta:%s\", name);\n  return this.options.get(name);\n};\n/**\n * Callback helper\n * @param path\n */\nBrowserSync.prototype.getOptionIn = function (path) {\n  this.debug(\"Getting option via path: {magenta:%s\", path);\n  return this.options.getIn(path);\n};\n/**\n * @returns {BrowserSync.options}\n */\nBrowserSync.prototype.getOptions = function () {\n  return this.options;\n};\n/**\n * @returns {BrowserSync.options}\n */\nBrowserSync.prototype.getLogger = logger.getLogger;\n/**\n * @param {String} name\n * @param {*} value\n * @returns {BrowserSync.options|*}\n */\nBrowserSync.prototype.setOption = function (name, value, opts) {\n  var bs = this;\n  opts = opts || {};\n  bs.debug(\"Setting Option: {cyan:%s} - {magenta:%s\", name, value.toString());\n  bs.options = bs.options.set(name, value);\n  if (!opts.silent) {\n    bs.events.emit(\"options:set\", {\n      path: name,\n      value: value,\n      options: bs.options\n    });\n  }\n  return this.options;\n};\n/**\n * @param path\n * @param value\n * @param opts\n * @returns {Map|*|BrowserSync.options}\n */\nBrowserSync.prototype.setOptionIn = function (path, value, opts) {\n  var bs = this;\n  opts = opts || {};\n  bs.debug(\"Setting Option: {cyan:%s} - {magenta:%s\", path.join(\".\"), value.toString());\n  bs.options = bs.options.setIn(path, value);\n  if (!opts.silent) {\n    bs.events.emit(\"options:set\", {\n      path: path,\n      value: value,\n      options: bs.options\n    });\n  }\n  return bs.options;\n};\n/**\n * Set multiple options with mutations\n * @param fn\n * @param opts\n * @returns {Map|*}\n */\nBrowserSync.prototype.setMany = function (fn, opts) {\n  var bs = this;\n  opts = opts || {};\n  bs.debug(\"Setting multiple Options\");\n  bs.options = bs.options.withMutations(fn);\n  if (!opts.silent) {\n    bs.events.emit(\"options:set\", {\n      options: bs.options.toJS()\n    });\n  }\n  return this.options;\n};\nBrowserSync.prototype.addRewriteRule = function (rule) {\n  var bs = this;\n  bs.options = bs.options.update(\"rewriteRules\", function (rules) {\n    return rules.concat(rule);\n  });\n  bs.resetMiddlewareStack();\n};\nBrowserSync.prototype.removeRewriteRule = function (id) {\n  var bs = this;\n  bs.options = bs.options.update(\"rewriteRules\", function (rules) {\n    return rules.filter(function (rule) {\n      return rule.id !== id;\n    });\n  });\n  bs.resetMiddlewareStack();\n};\nBrowserSync.prototype.setRewriteRules = function (rules) {\n  var bs = this;\n  bs.options = bs.options.update(\"rewriteRules\", function (_) {\n    return rules;\n  });\n  bs.resetMiddlewareStack();\n};\n/**\n * Add a new rewrite rule to the stack\n * @param {Object} rule\n */\nBrowserSync.prototype.resetMiddlewareStack = function () {\n  var bs = this;\n  var middlewares = require(\"./server/utils\").getMiddlewares(bs, bs.options);\n  bs.app.stack = middlewares;\n};\n/**\n * @param fn\n */\nBrowserSync.prototype.registerCleanupTask = function (fn) {\n  this._cleanupTasks.push(fn);\n};\n/**\n * Instance Cleanup\n */\nBrowserSync.prototype.cleanup = function (cb) {\n  var bs = this;\n  if (!bs.active) {\n    return;\n  }\n  // Remove all event listeners\n  if (bs.events) {\n    bs.debug(\"Removing event listeners...\");\n    bs.events.removeAllListeners();\n  }\n  // Close any core file watchers\n  if (bs.watchers) {\n    Object.keys(bs.watchers).forEach(function (key) {\n      bs.watchers[key].watchers.forEach(function (watcher) {\n        watcher.close();\n      });\n    });\n  }\n  // Run any additional clean up tasks\n  bs._cleanupTasks.forEach(function (fn) {\n    if (_.isFunction(fn)) {\n      fn(bs);\n    }\n  });\n  // Reset the flag\n  bs.debug(\"Setting {magenta:active: false\");\n  bs.active = false;\n  bs.paused = false;\n  bs.pluginManager.plugins = {};\n  bs.pluginManager.pluginOptions = {};\n  bs.pluginManager.defaultPlugins = defaultPlugins;\n  bs._userPlugins = [];\n  bs.userPlugins = [];\n  bs._reloadTimer = undefined;\n  bs._reloadQueue = [];\n  bs._cleanupTasks = [];\n  if (_.isFunction(cb)) {\n    cb(null, bs);\n  }\n};\nmodule.exports = BrowserSync;","map":{"version":3,"mappings":"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","names":["hooks","require","asyncTasks","config","connectUtils","utils","logger","eachSeries","_","EE","defaultPlugins","socket","server","tunnel","UI","BrowserSync","emitter","bs","cwd","process","active","paused","events","_userPlugins","_reloadQueue","_cleanupTasks","_browserReload","pluginManager","prototype","callback","name","cb","options","getIn","isFunction","apply","publicInstance","toArray","arguments","slice","init","defaultCallback","verifyConfig","_options","get","debugger","clone","useLevelPrefixes","debug","taskRunner","tasksComplete","item","step","fn","executeTask","err","out","handleOut","setOptions","optionsIn","forEach","setOptionIn","path","value","instance","Object","keys","key","length","setMany","set","setOption","setOnce","error","message","emit","baseDir","type","port","url","urls","toJS","registerPlugin","module","opts","push","getUserPlugin","items","getUserPlugins","filter","userPlugins","map","plugin","_enabled","pluginOptions","getMiddleware","types","connector","socketConnector","req","res","setHeader","end","_serveFileCount","serveFile","props","mode","entry","handle","content","id","route","_addMiddlewareToStack","app","stack","splice","_addMiddlewareCount","addMiddleware","override","update","mw","insert","size","concat","resetMiddlewareStack","removeMiddleware","getSocketConnector","getExternalSocketConnector","withMutations","merge","getOption","getOptionIn","getOptions","getLogger","toString","silent","join","setIn","addRewriteRule","rule","rules","removeRewriteRule","setRewriteRules","middlewares","getMiddlewares","registerCleanupTask","cleanup","removeAllListeners","watchers","watcher","close","plugins","_reloadTimer","undefined","exports"],"sources":["../lib/browser-sync.js"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}