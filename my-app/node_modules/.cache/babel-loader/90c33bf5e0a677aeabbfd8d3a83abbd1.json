{"ast":null,"code":"var ThrottleGroup = require(\"stream-throttle\").ThrottleGroup;\nmodule.exports = throttle;\n\n/**\n *\n */\nfunction throttle(opts, listenHost) {\n  var options = {\n    local_host: listenHost,\n    remote_host: listenHost,\n    upstream: 10 * 1024,\n    downstream: opts.speed.speed * 1024,\n    keepalive: false\n  };\n  var serverOpts = {\n    allowHalfOpen: true,\n    rejectUnauthorized: false\n  };\n  var module = \"net\";\n  var method = \"createConnection\";\n  if (opts.key) {\n    module = \"tls\";\n    method = \"connect\";\n    serverOpts.key = opts.key;\n    serverOpts.cert = opts.cert;\n  }\n  return require(module).createServer(serverOpts, function (local) {\n    var remote = require(module)[method]({\n      host: opts.target.hostname,\n      port: opts.target.port,\n      allowHalfOpen: true,\n      rejectUnauthorized: false\n    });\n    var upThrottle = new ThrottleGroup({\n      rate: options.upstream\n    });\n    var downThrottle = new ThrottleGroup({\n      rate: options.downstream\n    });\n    var localThrottle = upThrottle.throttle();\n    var remoteThrottle = downThrottle.throttle();\n    setTimeout(function () {\n      local.pipe(localThrottle).pipe(remote);\n    }, opts.speed.latency);\n    setTimeout(function () {\n      remote.pipe(remoteThrottle).pipe(local);\n    }, opts.speed.latency);\n    local.on(\"error\", function () {\n      remote.destroy();\n      local.destroy();\n    });\n    remote.on(\"error\", function () {\n      local.destroy();\n      remote.destroy();\n    });\n  });\n}","map":{"version":3,"names":["ThrottleGroup","require","module","exports","throttle","opts","listenHost","options","local_host","remote_host","upstream","downstream","speed","keepalive","serverOpts","allowHalfOpen","rejectUnauthorized","method","key","cert","createServer","local","remote","host","target","hostname","port","upThrottle","rate","downThrottle","localThrottle","remoteThrottle","setTimeout","pipe","latency","on","destroy"],"sources":["/home/user/Рабочий стол/pizza/project/node_modules/browser-sync-ui/lib/plugins/network-throttle/throttle-server.js"],"sourcesContent":["var ThrottleGroup = require(\"stream-throttle\").ThrottleGroup;\n\nmodule.exports = throttle;\n\n/**\n *\n */\nfunction throttle (opts, listenHost) {\n\n    var options = {\n        local_host:  listenHost,\n        remote_host: listenHost,\n        upstream:    10*1024,\n        downstream:  opts.speed.speed * 1024,\n        keepalive:   false\n    };\n\n    var serverOpts = {\n        allowHalfOpen: true,\n        rejectUnauthorized: false\n    };\n\n    var module = \"net\";\n    var method = \"createConnection\";\n\n    if (opts.key) {\n        module = \"tls\";\n        method = \"connect\";\n        serverOpts.key = opts.key;\n        serverOpts.cert = opts.cert;\n    }\n\n    return require(module).createServer(serverOpts, function (local) {\n\n        var remote = require(module)[method]({\n            host: opts.target.hostname,\n            port: opts.target.port,\n            allowHalfOpen: true,\n            rejectUnauthorized: false\n        });\n\n        var upThrottle = new ThrottleGroup({ rate: options.upstream });\n        var downThrottle = new ThrottleGroup({ rate: options.downstream });\n\n        var localThrottle = upThrottle.throttle();\n        var remoteThrottle = downThrottle.throttle();\n\n        setTimeout(function () {\n            local\n                .pipe(localThrottle)\n                .pipe(remote);\n        }, opts.speed.latency);\n\n        setTimeout(function () {\n            remote\n                .pipe(remoteThrottle)\n                .pipe(local);\n        }, opts.speed.latency);\n\n        local.on(\"error\", function() {\n            remote.destroy();\n            local.destroy();\n        });\n\n        remote.on(\"error\", function() {\n            local.destroy();\n            remote.destroy();\n        });\n    });\n}\n"],"mappings":"AAAA,IAAIA,aAAa,GAAGC,OAAO,CAAC,iBAAiB,CAAC,CAACD,aAAa;AAE5DE,MAAM,CAACC,OAAO,GAAGC,QAAQ;;AAEzB;AACA;AACA;AACA,SAASA,QAAQ,CAAEC,IAAI,EAAEC,UAAU,EAAE;EAEjC,IAAIC,OAAO,GAAG;IACVC,UAAU,EAAGF,UAAU;IACvBG,WAAW,EAAEH,UAAU;IACvBI,QAAQ,EAAK,EAAE,GAAC,IAAI;IACpBC,UAAU,EAAGN,IAAI,CAACO,KAAK,CAACA,KAAK,GAAG,IAAI;IACpCC,SAAS,EAAI;EACjB,CAAC;EAED,IAAIC,UAAU,GAAG;IACbC,aAAa,EAAE,IAAI;IACnBC,kBAAkB,EAAE;EACxB,CAAC;EAED,IAAId,MAAM,GAAG,KAAK;EAClB,IAAIe,MAAM,GAAG,kBAAkB;EAE/B,IAAIZ,IAAI,CAACa,GAAG,EAAE;IACVhB,MAAM,GAAG,KAAK;IACde,MAAM,GAAG,SAAS;IAClBH,UAAU,CAACI,GAAG,GAAGb,IAAI,CAACa,GAAG;IACzBJ,UAAU,CAACK,IAAI,GAAGd,IAAI,CAACc,IAAI;EAC/B;EAEA,OAAOlB,OAAO,CAACC,MAAM,CAAC,CAACkB,YAAY,CAACN,UAAU,EAAE,UAAUO,KAAK,EAAE;IAE7D,IAAIC,MAAM,GAAGrB,OAAO,CAACC,MAAM,CAAC,CAACe,MAAM,CAAC,CAAC;MACjCM,IAAI,EAAElB,IAAI,CAACmB,MAAM,CAACC,QAAQ;MAC1BC,IAAI,EAAErB,IAAI,CAACmB,MAAM,CAACE,IAAI;MACtBX,aAAa,EAAE,IAAI;MACnBC,kBAAkB,EAAE;IACxB,CAAC,CAAC;IAEF,IAAIW,UAAU,GAAG,IAAI3B,aAAa,CAAC;MAAE4B,IAAI,EAAErB,OAAO,CAACG;IAAS,CAAC,CAAC;IAC9D,IAAImB,YAAY,GAAG,IAAI7B,aAAa,CAAC;MAAE4B,IAAI,EAAErB,OAAO,CAACI;IAAW,CAAC,CAAC;IAElE,IAAImB,aAAa,GAAGH,UAAU,CAACvB,QAAQ,EAAE;IACzC,IAAI2B,cAAc,GAAGF,YAAY,CAACzB,QAAQ,EAAE;IAE5C4B,UAAU,CAAC,YAAY;MACnBX,KAAK,CACAY,IAAI,CAACH,aAAa,CAAC,CACnBG,IAAI,CAACX,MAAM,CAAC;IACrB,CAAC,EAAEjB,IAAI,CAACO,KAAK,CAACsB,OAAO,CAAC;IAEtBF,UAAU,CAAC,YAAY;MACnBV,MAAM,CACDW,IAAI,CAACF,cAAc,CAAC,CACpBE,IAAI,CAACZ,KAAK,CAAC;IACpB,CAAC,EAAEhB,IAAI,CAACO,KAAK,CAACsB,OAAO,CAAC;IAEtBb,KAAK,CAACc,EAAE,CAAC,OAAO,EAAE,YAAW;MACzBb,MAAM,CAACc,OAAO,EAAE;MAChBf,KAAK,CAACe,OAAO,EAAE;IACnB,CAAC,CAAC;IAEFd,MAAM,CAACa,EAAE,CAAC,OAAO,EAAE,YAAW;MAC1Bd,KAAK,CAACe,OAAO,EAAE;MACfd,MAAM,CAACc,OAAO,EAAE;IACpB,CAAC,CAAC;EACN,CAAC,CAAC;AACN"},"metadata":{},"sourceType":"script"}