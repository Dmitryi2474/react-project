{"ast":null,"code":"\"use strict\";\n\nvar utils = require(\"./utils\");\nvar fileUtils = require(\"./file-utils\");\nvar Rx = require(\"rx\");\nvar fromEvent = Rx.Observable.fromEvent;\nvar fileHandler = require(\"./file-event-handler\");\nmodule.exports = function (bs) {\n  var events = {\n    /**\n     * File reloads\n     * @param data\n     */\n    \"file:reload\": function (data) {\n      bs.io.sockets.emit(\"file:reload\", data);\n    },\n    /**\n     * Browser Reloads\n     */\n    \"browser:reload\": function () {\n      bs.io.sockets.emit(\"browser:reload\");\n    },\n    /**\n     * Browser Notify\n     * @param data\n     */\n    \"browser:notify\": function (data) {\n      bs.io.sockets.emit(\"browser:notify\", data);\n    },\n    /**\n     * Things that happened after the service is running\n     * @param data\n     */\n    \"service:running\": function (data) {\n      var mode = bs.options.get(\"mode\");\n      var open = bs.options.get(\"open\");\n      if (mode === \"proxy\" || mode === \"server\" || open === \"ui\" || open === \"ui-external\") {\n        utils.openBrowser(data.url, bs.options, bs);\n      }\n      // log about any file watching\n      if (bs.watchers) {\n        bs.events.emit(\"file:watching\", bs.watchers);\n      }\n    },\n    /**\n     * Option setting\n     * @param data\n     */\n    \"options:set\": function (data) {\n      if (bs.io) {\n        bs.io.sockets.emit(\"options:set\", data);\n      }\n    },\n    /**\n     * Plugin configuration setting\n     * @param data\n     */\n    \"plugins:configure\": function (data) {\n      if (data.active) {\n        bs.pluginManager.enablePlugin(data.name);\n      } else {\n        bs.pluginManager.disablePlugin(data.name);\n      }\n      bs.setOption(\"userPlugins\", bs.getUserPlugins());\n    },\n    \"plugins:opts\": function (data) {\n      if (bs.pluginManager.pluginOptions[data.name]) {\n        bs.pluginManager.pluginOptions[data.name] = data.opts;\n        bs.setOption(\"userPlugins\", bs.getUserPlugins());\n      }\n    }\n  };\n  Object.keys(events).forEach(function (event) {\n    bs.events.on(event, events[event]);\n  });\n  var reloader = fileHandler.applyReloadOperators(fromEvent(bs.events, \"_browser:reload\"), bs.options).subscribe(function () {\n    bs.events.emit(\"browser:reload\");\n  });\n  var coreNamespacedWatchers = fromEvent(bs.events, \"file:changed\").filter(function () {\n    return bs.options.get(\"codeSync\");\n  }).filter(function (x) {\n    return x.namespace === \"core\";\n  });\n  var handler = fileHandler.fileChanges(coreNamespacedWatchers, bs.options).subscribe(function (x) {\n    if (x.type === \"reload\") {\n      bs.events.emit(\"browser:reload\", x);\n    }\n    if (x.type === \"inject\") {\n      x.files.forEach(function (data) {\n        if (!bs.paused && data.namespace === \"core\") {\n          bs.events.emit(\"file:reload\", fileUtils.getFileInfo(data, bs.options));\n        }\n      });\n    }\n  });\n  bs.registerCleanupTask(function () {\n    handler.dispose();\n    reloader.dispose();\n  });\n};","map":{"version":3,"mappings":"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","names":["utils","require","fileUtils","Rx","fromEvent","Observable","fileHandler","module","exports","bs","events","data","io","sockets","emit","mode","options","get","open","openBrowser","url","watchers","active","pluginManager","enablePlugin","name","disablePlugin","setOption","getUserPlugins","pluginOptions","opts","Object","keys","forEach","event","on","reloader","applyReloadOperators","subscribe","coreNamespacedWatchers","filter","x","namespace","handler","fileChanges","type","files","paused","getFileInfo","registerCleanupTask","dispose"],"sources":["../lib/internal-events.js"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}