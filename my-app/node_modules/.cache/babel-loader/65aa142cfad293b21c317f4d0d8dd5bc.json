{"ast":null,"code":"var utils = require(\"./utils\");\n/**\n * Apply the operators that apply to the 'file:changed' event\n * @param {Rx.Observable} subject\n * @param options\n * @return {Rx.Observable<{type: string, files: Array<any>}>}\n */\nfunction fileChanges(subject, options) {\n  var operators = [{\n    option: \"reloadThrottle\",\n    fnName: \"throttle\"\n  }, {\n    option: \"reloadDelay\",\n    fnName: \"delay\"\n  }];\n  var scheduler = options.getIn([\"debug\", \"scheduler\"]);\n  /**\n   * Create a stream buffered/debounced stream of events\n   */\n  var initial = getAggregatedDebouncedStream(subject, options, scheduler);\n  return applyOperators(operators, initial, options, scheduler).map(function (items) {\n    var paths = items.map(function (x) {\n      return x.path;\n    });\n    if (utils.willCauseReload(paths, options.get(\"injectFileTypes\").toJS())) {\n      return {\n        type: \"reload\",\n        files: items\n      };\n    }\n    return {\n      type: \"inject\",\n      files: items\n    };\n  });\n}\nmodule.exports.fileChanges = fileChanges;\n/**\n * Apply the operators that apply to the 'browser:reload' event\n * @param {Rx.Observable} subject\n * @param options\n * @returns {Rx.Observable}\n */\nfunction applyReloadOperators(subject, options) {\n  var operators = [{\n    option: \"reloadDebounce\",\n    fnName: \"debounce\"\n  }, {\n    option: \"reloadThrottle\",\n    fnName: \"throttle\"\n  }, {\n    option: \"reloadDelay\",\n    fnName: \"delay\"\n  }];\n  return applyOperators(operators, subject, options, options.getIn([\"debug\", \"scheduler\"]));\n}\nmodule.exports.applyReloadOperators = applyReloadOperators;\n/**\n * @param items\n * @param subject\n * @param options\n * @param scheduler\n */\nfunction applyOperators(items, subject, options, scheduler) {\n  return items.reduce(function (subject, item) {\n    var value = options.get(item.option);\n    if (value > 0) {\n      return subject[item.fnName].call(subject, value, scheduler);\n    }\n    return subject;\n  }, subject);\n}\n/**\n * @param subject\n * @param options\n * @param scheduler\n */\nfunction getAggregatedDebouncedStream(subject, options, scheduler) {\n  return subject.filter(function (x) {\n    return options.get(\"watchEvents\").indexOf(x.event) > -1;\n  }).buffer(subject.debounce(options.get(\"reloadDebounce\"), scheduler));\n}","map":{"version":3,"mappings":"AAAA,IAAIA,KAAK,GAAGC,OAAO,CAAC,SAAS,CAAC;AAE9B;;;;;;AAMA,SAASC,WAAW,CAACC,OAAO,EAAEC,OAAO;EACjC,IAAMC,SAAS,GAAG,CACd;IACIC,MAAM,EAAE,gBAAgB;IACxBC,MAAM,EAAE;GACX,EACD;IACID,MAAM,EAAE,aAAa;IACrBC,MAAM,EAAE;GACX,CACJ;EAED,IAAMC,SAAS,GAAGJ,OAAO,CAACK,KAAK,CAAC,CAAC,OAAO,EAAE,WAAW,CAAC,CAAC;EAEvD;;;EAGA,IAAMC,OAAO,GAAGC,4BAA4B,CAACR,OAAO,EAAEC,OAAO,EAAEI,SAAS,CAAC;EAEzE,OAAOI,cAAc,CAACP,SAAS,EAAEK,OAAO,EAAEN,OAAO,EAAEI,SAAS,CAAC,CACxDK,GAAG,CAAC,UAASC,KAAK;IACf,IAAMC,KAAK,GAAGD,KAAK,CAACD,GAAG,CAAC,WAAC;MAAI,QAAC,CAACG,IAAI;IAAN,CAAM,CAAC;IAEpC,IACIhB,KAAK,CAACiB,eAAe,CAACF,KAAK,EAAEX,OAAO,CAACc,GAAG,CAAC,iBAAiB,CAAC,CAACC,IAAI,EAAE,CAAC,EACrE;MACE,OAAO;QACHC,IAAI,EAAE,QAAQ;QACdC,KAAK,EAAEP;OACV;;IAEL,OAAO;MACHM,IAAI,EAAE,QAAQ;MACdC,KAAK,EAAEP;KACV;EACL,CAAC,CAAC;AACV;AACAQ,MAAM,CAACC,OAAO,CAACrB,WAAW,GAAGA,WAAW;AAExC;;;;;;AAMA,SAASsB,oBAAoB,CAACrB,OAAO,EAAEC,OAAO;EAC1C,IAAIC,SAAS,GAAG,CACZ;IACIC,MAAM,EAAE,gBAAgB;IACxBC,MAAM,EAAE;GACX,EACD;IACID,MAAM,EAAE,gBAAgB;IACxBC,MAAM,EAAE;GACX,EACD;IACID,MAAM,EAAE,aAAa;IACrBC,MAAM,EAAE;GACX,CACJ;EAED,OAAOK,cAAc,CACjBP,SAAS,EACTF,OAAO,EACPC,OAAO,EACPA,OAAO,CAACK,KAAK,CAAC,CAAC,OAAO,EAAE,WAAW,CAAC,CAAC,CACxC;AACL;AACAa,MAAM,CAACC,OAAO,CAACC,oBAAoB,GAAGA,oBAAoB;AAE1D;;;;;;AAMA,SAASZ,cAAc,CAACE,KAAK,EAAEX,OAAO,EAAEC,OAAO,EAAEI,SAAS;EACtD,OAAOM,KAAK,CAACW,MAAM,CAAC,UAAStB,OAAO,EAAEuB,IAAI;IACtC,IAAIC,KAAK,GAAGvB,OAAO,CAACc,GAAG,CAACQ,IAAI,CAACpB,MAAM,CAAC;IACpC,IAAIqB,KAAK,GAAG,CAAC,EAAE;MACX,OAAOxB,OAAO,CAACuB,IAAI,CAACnB,MAAM,CAAC,CAACqB,IAAI,CAACzB,OAAO,EAAEwB,KAAK,EAAEnB,SAAS,CAAC;;IAE/D,OAAOL,OAAO;EAClB,CAAC,EAAEA,OAAO,CAAC;AACf;AAEA;;;;;AAKA,SAASQ,4BAA4B,CAACR,OAAO,EAAEC,OAAO,EAAEI,SAAS;EAC7D,OAAOL,OAAO,CACT0B,MAAM,CAAC,UAASC,CAAC;IACd,OAAO1B,OAAO,CAACc,GAAG,CAAC,aAAa,CAAC,CAACa,OAAO,CAACD,CAAC,CAACE,KAAK,CAAC,GAAG,CAAC,CAAC;EAC3D,CAAC,CAAC,CACDC,MAAM,CAAC9B,OAAO,CAAC+B,QAAQ,CAAC9B,OAAO,CAACc,GAAG,CAAC,gBAAgB,CAAC,EAAEV,SAAS,CAAC,CAAC;AAC3E","names":["utils","require","fileChanges","subject","options","operators","option","fnName","scheduler","getIn","initial","getAggregatedDebouncedStream","applyOperators","map","items","paths","path","willCauseReload","get","toJS","type","files","module","exports","applyReloadOperators","reduce","item","value","call","filter","x","indexOf","event","buffer","debounce"],"sources":["../lib/file-event-handler.js"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}